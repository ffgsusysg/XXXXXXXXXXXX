<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª - Ø£Ø¯Ø§Ø© Ù…ØªØ·ÙˆØ±Ø©</title>
    <!-- ØªØ¶Ù…ÙŠÙ† Ù…ÙƒØªØ¨Ø© Tailwind CSS Ù…Ù† Ø®Ù„Ø§Ù„ CDN Ù„Ø¥Ø¶Ø§ÙØ© ØªØµÙ…ÙŠÙ… Ø¹ØµØ±ÙŠ ÙˆÙ…Ø¤Ø«Ø±Ø§Øª Ø¬Ù…ÙŠÙ„Ø© -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #0d0d1a;
        }
        
        /* Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø«Ø±Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù„Ø²Ø± */
        .btn-primary {
            background-image: linear-gradient(to right, #00c6ff, #0072ff);
            box-shadow: 0 4px 15px rgba(0, 198, 255, 0.4);
            transition: all 0.3s ease-in-out;
            transform: scale(1);
        }
        
        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 198, 255, 0.6);
        }

        /* Ù…Ø¤Ø«Ø±Ø§Øª ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª */
        .lesson-item {
            animation: fadeIn 0.5s ease-out forwards;
            opacity: 0;
            background: rgba(25, 30, 45, 0.5); /* Ø®Ù„ÙÙŠØ© Ø´Ø¨Ù‡ Ø´ÙØ§ÙØ© */
            backdrop-filter: blur(10px); /* ØªØ£Ø«ÙŠØ± Ø¶Ø¨Ø§Ø¨ÙŠ */
            border: 1px solid rgba(0, 198, 255, 0.2);
        }
        
        .lesson-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 198, 255, 0.3);
            border-color: rgba(0, 198, 255, 0.5);
        }
        
        /* Ù…Ø¤Ø«Ø±Ø§Øª ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Ø¬Ø¹Ù„ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù…ØªÙ†Ø§Ø³Ù‚Ø© Ù…Ø¹ ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ÙˆÙ‚Ø¹ */
        .text-accent {
            color: #00c6ff;
        }

        .border-accent {
            border-color: #00c6ff;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª */
        .alert-box.success {
            background-color: #2e7d32;
            border-color: #66bb6a;
        }

        .alert-box.error {
            background-color: #c62828;
            border-color: #ef5350;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 p-8 flex justify-center items-center min-h-screen">

    <div class="container bg-gray-800 bg-opacity-70 backdrop-blur-sm p-8 rounded-2xl shadow-xl max-w-lg w-full transform transition-transform duration-500 hover:scale-[1.01] animate-fadeIn border-2 border-gray-700">
        
        <h1 class="text-3xl md:text-4xl font-bold text-center mb-6 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-500">
            ğŸ“š Ø£Ø¯Ø§Ø© Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª
        </h1>

        <div class="space-y-6">
            <!-- Ù‚Ø³Ù… Ø¥Ø¶Ø§ÙØ© Ù…Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯ -->
            <div class="p-6 bg-gray-900 rounded-xl shadow-inner border border-gray-700">
                <h3 class="text-xl font-bold text-gray-200 mb-4">Ø¥Ø¶Ø§ÙØ© Ù…Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯:</h3>
                <input type="text" id="teacherName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³" class="w-full p-3 rounded-lg bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-colors duration-300">
                <input type="number" id="subjectId" placeholder="Subject ID" class="w-full p-3 rounded-lg bg-gray-700 text-white placeholder-gray-400 mt-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-colors duration-300">
                <input type="number" id="itemId" placeholder="Item ID" class="w-full p-3 rounded-lg bg-gray-700 text-white placeholder-gray-400 mt-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-colors duration-300">
                <input type="number" id="subtopicId" placeholder="Subtopic ID" class="w-full p-3 rounded-lg bg-gray-700 text-white placeholder-gray-400 mt-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-colors duration-300">
                <button onclick="addTeacher()" class="btn-primary w-full p-3 mt-5 rounded-lg font-bold text-lg text-white">â• Ø­ÙØ¸ Ø§Ù„Ù…Ø¯Ø±Ø³</button>
            </div>

            <!-- Ù‚Ø³Ù… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¯Ø±Ø³ ÙˆØ¬Ù„Ø¨ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª -->
            <div class="p-6 bg-gray-900 rounded-xl shadow-inner border border-gray-700">
                <h3 class="text-xl font-bold text-gray-200 mb-4">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯Ø±Ø³:</h3>
                <select id="teacherSelect" class="w-full p-3 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-colors duration-300"></select>
                <button onclick="fetchLessons()" class="btn-primary w-full p-3 mt-5 rounded-lg font-bold text-lg text-white">ğŸ“¥ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</button>
            </div>
            
            <!-- Ù‚Ø³Ù… Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ÙŠØ© -->
            <div id="lessonsContainer" class="space-y-4"></div>
            <div id="alertBox" class="alert-box text-center p-3 rounded-lg font-bold text-white transition-opacity duration-300 opacity-0"></div>
        </div>
    </div>

    <script>
        // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø«ÙˆØ§Ø¨Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ø§Ù„Ø³ÙƒØ±Ø¨Øª
        const BASE_URL = "https://gw.abgateway.com/content/next-item";
        const teacherSelect = document.getElementById("teacherSelect");
        const lessonsContainer = document.getElementById("lessonsContainer");
        const alertBox = document.getElementById("alertBox");

        /**
         * Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¨ÙŠÙ‡ÙŠØ© ÙÙŠ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª.
         * @param {string} message - Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¹Ø±Ø¶Ù‡Ø§.
         * @param {string} type - Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ("success" Ù„Ù„Ù†Ø¬Ø§Ø­ØŒ "error" Ù„Ù„Ø®Ø·Ø£).
         */
        function showAlert(message, type) {
            alertBox.textContent = message;
            alertBox.className = `alert-box text-center p-3 rounded-lg font-bold text-white transition-opacity duration-300 opacity-100 ${type}`;
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†
            setTimeout(() => {
                alertBox.classList.remove('opacity-100');
                alertBox.classList.add('opacity-0');
            }, 5000);
        }

        /**
         * ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ† Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ© (localStorage).
         */
        function loadTeachers() {
            teacherSelect.innerHTML = '';
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ† Ù…Ù† localStorage Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† ÙØ§Ø±Øº Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§
            const teachers = JSON.parse(localStorage.getItem("teachers") || "{}");
            
            // Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø± Ø§ÙØªØ±Ø§Ø¶ÙŠ
            const defaultOption = document.createElement("option");
            defaultOption.value = "";
            defaultOption.textContent = "--- Ø§Ø®ØªØ± Ù…Ø¯Ø±Ø³Ù‹Ø§ ---";
            teacherSelect.appendChild(defaultOption);
            
            // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„ Ù…Ø¯Ø±Ø³ ÙƒØ®ÙŠØ§Ø± ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
            for (const name in teachers) {
                const option = document.createElement("option");
                option.value = name;
                option.textContent = name;
                teacherSelect.appendChild(option);
            }
        }

        /**
         * Ø¥Ø¶Ø§ÙØ© Ù…Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯ ÙˆØ­ÙØ¸Ù‡ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ© (localStorage).
         * ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù‡Ù†Ø§.
         */
        function addTeacher() {
            const name = document.getElementById("teacherName").value.trim();
            const subject_id = +document.getElementById("subjectId").value;
            const item_id = +document.getElementById("itemId").value;
            const subtopic_id = +document.getElementById("subtopicId").value;

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…Ù…Ù„ÙˆØ¡Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
            if (!name || !subject_id || !item_id || !subtopic_id) {
                showAlert("âŒ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.", "error");
                return;
            }

            const teachers = JSON.parse(localStorage.getItem("teachers") || "{}");
            teachers[name] = { subject_id, item_id, subtopic_id };
            localStorage.setItem("teachers", JSON.stringify(teachers));
            loadTeachers();
            showAlert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø¯Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­.", "success");
        }

        /**
         * Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ù…Ù† API Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø±Ø³ Ø§Ù„Ù…Ø®ØªØ§Ø±.
         * ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… `fetch` Ùˆ`template literals`.
         */
        async function fetchLessons() {
            const selectedTeacher = teacherSelect.value;
            if (!selectedTeacher) {
                showAlert("âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¯Ø±Ø³.", "error");
                return;
            }

            lessonsContainer.innerHTML = '';
            showAlert("â³ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª...", "info");

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø³ Ø§Ù„Ù…Ø®ØªØ§Ø±
            const { subject_id, item_id: startItemId, subtopic_id: startSubtopicId } = JSON.parse(localStorage.getItem("teachers"))[selectedTeacher];

            let item_id = startItemId;
            let subtopic_id = startSubtopicId;
            const item_type = "lesson";
            const results = [];
            let lessonCount = 0; // Ù…ØªØºÙŠØ± Ù„ØªØªØ¨Ø¹ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª

            try {
                // Ø§Ù„Ø­Ù„Ù‚Ø© ØªØ³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ø¬Ù„Ø¨ Ø­ØªÙ‰ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ùˆ ÙŠØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø­Ø¯ Ù…Ø¹ÙŠÙ†
                while (true) {
                    const params = new URLSearchParams({
                        subject_id,
                        item_id,
                        subtopic_id,
                        item_type
                    });

                    // ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù€ `template literal` Ù‡Ù†Ø§
                    const res = await fetch(`${BASE_URL}?${params.toString()}`, {
                        headers: { "User-Agent": "Mozilla/5.0" }
                    });

                    if (!res.ok) {
                        throw new Error("ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. Ù‚Ø¯ ØªÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ùˆ Ø§Ù„Ø´Ø¨ÙƒØ©.");
                    }

                    const json = await res.json();
                    const data = json.data;

                    // Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø­Ù„Ù‚Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª
                    if (!data || data.length === 0) {
                        break;
                    }

                    const lesson = data[0];
                    const title = (lesson.title_ar || "").trim();
                    item_id = lesson.id;
                    subtopic_id = lesson.subtopic_id;

                    // ØªØ®Ø·ÙŠ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø© "Ù‚Ø±ÙŠØ¨"
                    if (title.includes("Ù‚Ø±ÙŠØ¨")) {
                        continue;
                    }

                    results.push(lesson);
                    
                    // ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ‚Ø¯Ù…
                    lessonCount++;
                    lessonsContainer.innerHTML += `
                        <div class="lesson-item flex items-center justify-between p-4 rounded-xl shadow-lg border border-gray-700 bg-gray-900 text-sm md:text-base mb-4 transform transition-transform duration-300 hover:scale-105">
                            <div class="flex-grow text-right pr-4">
                                <strong class="text-lg md:text-xl text-blue-300 font-bold block mb-1">
                                    <span class="text-blue-500">ğŸ¥</span> ${lesson.title_ar}
                                </strong>
                                <span class="text-gray-400 block text-xs md:text-sm">
                                    ID: ${lesson.id} | Subtopic ID: ${lesson.subtopic_id}
                                </span>
                            </div>
                            <a href="${lesson.lesson_url}" target="_blank" class="text-cyan-400 hover:underline transition-colors duration-300 ml-4 flex-shrink-0">
                                ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©
                            </a>
                        </div>
                    `;
                    // Ø¥Ø¹Ø·Ø§Ø¡ ÙƒÙ„ Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯ Ù…Ø¯Ø®Ù„ ÙˆÙ‚Øª Ù„Ù„Ø¸Ù‡ÙˆØ±
                    const newLessonItem = lessonsContainer.lastElementChild;
                    newLessonItem.style.animationDelay = `${lessonCount * 0.1}s`;
                }

                if (results.length > 0) {
                    showAlert(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${results.length} Ù…Ø­Ø§Ø¶Ø±Ø©.`, "success");
                } else {
                    showAlert("ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©.", "error");
                }

            } catch (err) {
                showAlert(`âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ${err.message}`, "error");
                console.error(err);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ† Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØµÙØ­Ø©
        window.onload = loadTeachers;
    </script>
</body>
</html>
